<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Writing kak scripts :: Kakoune Docs</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Kakoune Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="Kakoune" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Kakoune</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/commands.html">Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/expansions.html">Expansions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/execeval.html">Exec Eval</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/scopes.html">Scopes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/faces.html">Faces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/buffers.html">Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/registers.html">Registers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/mapping.html">Mapping</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/hooks.html">Hooks</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/command-parsing.html">Command Parsing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/keys.html">Keys</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/regex.html">Regex</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/options.html">Options</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/highlighters.html">Highlighters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/modes.html">Modes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/keymap.html">KEYMAP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/faq.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pages/changelog.html">Changelog</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="design.html">Design</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="coding-style.html">Coding Style</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="writing_scripts.html">Writing Scripts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="json_ui.html">JSON UI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="autoedit.html">Autoedit</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfacing.html">Interfacing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../rc/tools/lint.html">Linting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../rc/tools/autorestore.html">Autorestore</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../rc/tools/doc.html">Doc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../test/tests.html">Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VIMTOKAK.html">Vi(m) to Kakoune</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kakoune</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Kakoune</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Kakoune</a></li>
    <li><a href="writing_scripts.html">Writing Scripts</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="file:///home/igor/personal/kakoune/modules/ROOT/pages/doc/writing_scripts.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Writing kak scripts</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#dependencies">1. Dependencies</a></li>
<li><a href="#naming-convention">2. Naming convention</a></li>
<li><a href="#documentation">3. Documentation</a></li>
<li><a href="#posix-shell">4. POSIX shell</a></li>
<li><a href="#common-shell-patterns">5. Common shell patterns</a>
<ul class="sectlevel2">
<li><a href="#printing-variables">5.1. Printing variables</a></li>
<li><a href="#variable-base-name">5.2. Variable base name</a></li>
<li><a href="#testing">5.3. Testing</a></li>
<li><a href="#standard-error-redirection">5.4. Standard error redirection</a></li>
<li><a href="#regular-expression">5.5. Regular expression</a></li>
<li><a href="#running-a-process-in-the-background">5.6. Running a process in the background</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Interaction with external tools from a Kakoune session is supported
through the use of scripts. Once loaded by the editor (either
automatically or manually), they allow extending the functionalities
provided by default through commands and hooks.</p>
</div>
<div class="paragraph">
<p>Their implementation should be kept as simple as possible, as they are
not meant to be generic tools themselves but a mere API to actual
software.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	                                       +------+
	                                  +--&gt; | tmux |
	                                  |    +------+
	                                  |
	+---------+                       |    +------+
	| Kakoune | &lt;-------&gt;  scripts  +-+--&gt; | X11  |
	+---------+                       |    +------+
	                                  |
	                                  |    +------+
	                                  +--&gt; | ...  |
	                                       +------+</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="anchor" href="#dependencies"></a><a class="link" href="#dependencies">1. Dependencies</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The amount of dependencies of a given script should be kept to a minimum
for practicality reasons, and have to be reasonable and expected
considering the purpose of the script itself.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>clang.kak</code> script provides with code completion using the <code>clang</code>
compiler</p>
</li>
<li>
<p>the <code>tmux.kak</code> script provides with terminal splitting using the
<code>tmux</code> multiplexer</p>
</li>
<li>
<p>the <code>ctags.kak</code> script provides with symbol lookups using the
<code>readtags</code> utility provided by some <code>ctags</code> implementations</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="naming-convention"><a class="anchor" href="#naming-convention"></a><a class="link" href="#naming-convention">2. Naming convention</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>All options and commands declared in a Kakoune script have to be
prefixed with the name of the script, or a one word description of the
purpose of the script.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in <code>tmux.kak</code>: command <code>tmux-new-window</code></p>
</li>
<li>
<p>in <code>comment.kak</code>: option <code>comment_line</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following conventions apply as well:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>options</strong>: if a separator is needed to separate a multiple word option
name, an underscore should be used to allow shell scopes to use them</p>
</li>
<li>
<p><strong>commands</strong>: if a separator is needed, a hyphen is usually used to
differentiate a command name from an option&#8217;s</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="documentation"><a class="anchor" href="#documentation"></a><a class="link" href="#documentation">3. Documentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Non-hidden commands and options should always be declared with a documentation
string, so that their purpose is clearly described whenever completed upon
interactively from the prompt.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="posix-shell"><a class="anchor" href="#posix-shell"></a><a class="link" href="#posix-shell">4. POSIX shell</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Shell expansions are a useful tool to interact with an external utility,
and the shell code that they contain should be as portable as possible. As
such, scripts that rely on those expansions have to be implemented with
POSIX in mind, most shells follow this standard nowadays which somewhat
guarantees that the script will be portable across the most common systems.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common-shell-patterns"><a class="anchor" href="#common-shell-patterns"></a><a class="link" href="#common-shell-patterns">5. Common shell patterns</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="printing-variables"><a class="anchor" href="#printing-variables"></a><a class="link" href="#printing-variables">5.1. Printing variables</a></h3>
<div class="paragraph">
<p>In order to print a string that contains a variable expansion, prefer
<code>printf</code> to <code>echo</code>, as the latter is implementation defined and may
interpret some characters differently depending on the shell (e.g.
flags, backslashes).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	printf %s\\n "${var}"
	printf "value: %s\\n" "${var}"</pre>
</div>
</div>
<div class="paragraph">
<p>The following won&#8217;t cause any issues, as the string to print doesn&#8217;t
contain ambiguous characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	echo "set global scrolloff 999,0"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about portability issues related to <code>echo</code>, refer to <a href="https://www.etalabs.net/sh_tricks.html">Rich&#8217;s sh tricks</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="variable-base-name"><a class="anchor" href="#variable-base-name"></a><a class="link" href="#variable-base-name">5.2. Variable base name</a></h3>
<div class="paragraph">
<p>Replace <code>$(basename "${var}")</code> with <code>"${var##*/}"</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing"><a class="anchor" href="#testing"></a><a class="link" href="#testing">5.3. Testing</a></h3>
<div class="paragraph">
<p>The <code>[[</code> keyword is provided by <code>bash</code>, and should be replaced with <code>[</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="standard-error-redirection"><a class="anchor" href="#standard-error-redirection"></a><a class="link" href="#standard-error-redirection">5.4. Standard error redirection</a></h3>
<div class="paragraph">
<p>Redirecting both standard and error streams is simplified in the <code>bash</code>
shell with the <code>&amp;&gt;</code> operator, however this syntax is not portable and
has to be replaced with the following: <code>&gt;/dev/null 2&gt;&amp;1</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="regular-expression"><a class="anchor" href="#regular-expression"></a><a class="link" href="#regular-expression">5.5. Regular expression</a></h3>
<div class="paragraph">
<p>The <code>bash</code> shell provides with a <code>[[</code> keyword that supports the <code>=~</code>
operator to match a regular expression against a variable. This
functionality can be implemented with the <code>expr</code> utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expr "${var}" : '[a-z]*' &gt;/dev/null</code> returns successfully when the
variable is empty or only contains lowercase characters, otherwise a
non-zero exit code is returned</p>
</li>
<li>
<p><code>expr "${var}" : '\([a-z]*\)'</code> prints the variable when empty or
only contains lowercase characters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the regular expression matches the whole string, using the <code>^</code>
and <code>$</code> anchors is an undefined behavior.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-a-process-in-the-background"><a class="anchor" href="#running-a-process-in-the-background"></a><a class="link" href="#running-a-process-in-the-background">5.6. Running a process in the background</a></h3>
<div class="paragraph">
<p>In order to get a process running in the background without having it
quit when the shell scope that spawns it terminates, use the following
syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	{
	    command
	} &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp;</pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
